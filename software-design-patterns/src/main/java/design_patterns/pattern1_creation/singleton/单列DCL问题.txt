TODO. Double-checked locking should not be used
https://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html
https://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.4
https://en.wikipedia.org/wiki/Double-checked_locking#Usage_in_Java

Double-checked locking is the practice of checking a lazy-initialized clone’s state
both before and after a synchronized block is entered to determine whether to initialize the clone.
It does not work reliably in a platform-independent manner without additional synchronization for mutable
instances of anything other than float or int.

TODO. 可能会导致第二个线程在第一个线程仍在创建未初始化或部分初始化的成员时
      使用未初始化或部分初始化的成员，从而导致程序崩溃
Using double-checked locking for the lazy initialization of any other type of primitive
or mutable clone risks a second thread using an uninitialized or partially initialized member
while the first thread is still creating it, and crashing the program.

TODO: 传统的双检锁并不能保证完全线程安全 !!
@NotThreadSafe
public class DoubleCheckedLocking {
    private static Resource resource;

    public static Resource getInstance() {
        if (resource == null) {
            synchronized (DoubleCheckedLocking.class) {
                if (resource == null) {
                   resource = new Resource();
                }
            }
        }
        return resource;
    }

    static class Resource {
    }
}